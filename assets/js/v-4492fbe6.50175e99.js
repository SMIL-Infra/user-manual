"use strict";(self.webpackChunksmil_infra_user_manual=self.webpackChunksmil_infra_user_manual||[]).push([[210],{7555:(l,e,s)=>{s.r(e),s.d(e,{default:()=>ol});var n=s(6252),a=s(3863),u=s(6507),p=s(6306),r=s(4054),t=s(5957),i=s(6532),_=s(4126),c=s(1097),g=s(7604),o=s(9183),m=s(2986),d=s(7331),b=s(526),h=s(2394),x=s(2667),f=s(691);const k=(0,n._)("h1",{id:"服务器校外访问",tabindex:"-1"},[(0,n._)("a",{class:"header-anchor",href:"#服务器校外访问","aria-hidden":"true"},"#"),(0,n.Uk)(" 服务器校外访问")],-1),U=(0,n._)("h2",{id:"前置条件",tabindex:"-1"},[(0,n._)("a",{class:"header-anchor",href:"#前置条件","aria-hidden":"true"},"#"),(0,n.Uk)(" 前置条件")],-1),v=(0,n._)("p",null,"在校外需要访问校内服务器，首先需要本地生成密钥文件，然后将对应公钥(id_rsa.pub)发送给服务器的管理同学（目前是陈国昊、张志扬），待管理员同学配置好之后才可以继续以下步骤。（此步骤自行搜索） 注意：跳板机的ip变为159.75.119.4，下图所有的120.77.220.179均改为159.75.119.4",-1),H=(0,n._)("p",null,[(0,n._)("img",{src:a,alt:"image-20211009103738645"})],-1),S=(0,n._)("h2",{id:"场景描述",tabindex:"-1"},[(0,n._)("a",{class:"header-anchor",href:"#场景描述","aria-hidden":"true"},"#"),(0,n.Uk)(" 场景描述")],-1),w=(0,n._)("p",null,[(0,n._)("img",{src:u,alt:"img"})],-1),P=(0,n._)("p",null,[(0,n.Uk)("注意：gpuxxx指的是校内服务器的"),(0,n._)("strong",null,"校内网IP")],-1),y=(0,n._)("p",null,"由于校园网的隔离限制，导致没法直接访问校内的服务器。所以得用跳板机打一下隧道。",-1),C=(0,n._)("p",null,"为了安全考虑，校园网只有两台服务器（gpu010和gpu023）暴露接口给外网。剩下的服务器就要以这两台服务器为新的跳板去访问。",-1),G=(0,n._)("p",null,"所以整个过程涉及两台跳板机：",-1),J=(0,n._)("ul",null,[(0,n._)("li",null,"第一层跳板机：自己购买的阿里云服务器"),(0,n._)("li",null,"第二层跳板机：暴露端口给外网的校内服务器（gpu010或者gpu023）")],-1),W=(0,n.Uk)("OpenSSH"),j=(0,n.Uk)("Xshell"),q=(0,n._)("h2",{id:"用命令行访问",tabindex:"-1"},[(0,n._)("a",{class:"header-anchor",href:"#用命令行访问","aria-hidden":"true"},"#"),(0,n.Uk)(" 用命令行访问")],-1),T=(0,n._)("div",{class:"language-bash ext-sh line-numbers-mode"},[(0,n._)("pre",{class:"language-bash"},[(0,n._)("code",null,[(0,n._)("span",{class:"token function"},"ssh"),(0,n.Uk)(" -J smil-proxy@jumpbox.scut-smil.cn,"),(0,n._)("span",{class:"token operator"},"<"),(0,n.Uk)("username"),(0,n._)("span",{class:"token operator"},">"),(0,n.Uk)("@localhost:2222 "),(0,n._)("span",{class:"token operator"},"<"),(0,n.Uk)("username"),(0,n._)("span",{class:"token operator"},">"),(0,n.Uk)("@gpuxxx\n")])]),(0,n._)("div",{class:"line-numbers"},[(0,n._)("span",{class:"line-number"},"1"),(0,n._)("br")])],-1),X=(0,n._)("p",null,[(0,n.Uk)("即在你通常用于登录服务器的命令中加入"),(0,n._)("code",null,"-J"),(0,n.Uk)("参数。其中端口号2222对应服务器gpu023，位于国际校区；2223对应服务器gpu010位于五山校区。各位可自行选择服务质量较高的线路。"),(0,n._)("code",null,"gpuxxx"),(0,n.Uk)("表示特定服务器的域名。")],-1),N=(0,n._)("h2",{id:"配置文件",tabindex:"-1"},[(0,n._)("a",{class:"header-anchor",href:"#配置文件","aria-hidden":"true"},"#"),(0,n.Uk)(" 配置文件")],-1),O=(0,n._)("p",null,"若要允许VS Code，scp等基于OpenSSH的工具使用跳板机从校外连接，或为了简化命令，可编辑OpenSSH的配置文件。",-1),z=(0,n._)("p",null,[(0,n.Uk)("在"),(0,n._)("a",{href:"./client-config.md?s:ssh_client=ssh"},"客户端配置"),(0,n.Uk)("的基础上，在"),(0,n._)("code",null,"Host *.scut-smil.cn"),(0,n.Uk)("（应用于所有服务器）或"),(0,n._)("code",null,"Host gpuxxx"),(0,n.Uk)("（应用于特定服务器）下，插入"),(0,n._)("code",null,"ProxyJump"),(0,n.Uk)("配置，其作用与命令行中"),(0,n._)("code",null,"-J"),(0,n.Uk)("的参数相同。示例配置：")],-1),D=(0,n._)("div",{class:"language-text ext-text line-numbers-mode"},[(0,n._)("pre",{class:"language-text"},[(0,n._)("code",null,"CanonicalizeHostname always\nCanonicalDomains scut-smil.cn\n\nHost *.scut-smil.cn\nUser <你的用户名>\n\nHost jumpbox\nUser smil-proxy\n\nHost gpu023 gpu010\nHostName localhost\nProxyJump jumpbox\nUser <你的用户名>\n\nHost gpu023\nPort 2222\n\nHost gpu010\nPort 2223\n\nHost gpu024\nProxyJump gpu023\n\nHost gpu011\nProxyJump gpu010\n")]),(0,n._)("div",{class:"line-numbers"},[(0,n._)("span",{class:"line-number"},"1"),(0,n._)("br"),(0,n._)("span",{class:"line-number"},"2"),(0,n._)("br"),(0,n._)("span",{class:"line-number"},"3"),(0,n._)("br"),(0,n._)("span",{class:"line-number"},"4"),(0,n._)("br"),(0,n._)("span",{class:"line-number"},"5"),(0,n._)("br"),(0,n._)("span",{class:"line-number"},"6"),(0,n._)("br"),(0,n._)("span",{class:"line-number"},"7"),(0,n._)("br"),(0,n._)("span",{class:"line-number"},"8"),(0,n._)("br"),(0,n._)("span",{class:"line-number"},"9"),(0,n._)("br"),(0,n._)("span",{class:"line-number"},"10"),(0,n._)("br"),(0,n._)("span",{class:"line-number"},"11"),(0,n._)("br"),(0,n._)("span",{class:"line-number"},"12"),(0,n._)("br"),(0,n._)("span",{class:"line-number"},"13"),(0,n._)("br"),(0,n._)("span",{class:"line-number"},"14"),(0,n._)("br"),(0,n._)("span",{class:"line-number"},"15"),(0,n._)("br"),(0,n._)("span",{class:"line-number"},"16"),(0,n._)("br"),(0,n._)("span",{class:"line-number"},"17"),(0,n._)("br"),(0,n._)("span",{class:"line-number"},"18"),(0,n._)("br"),(0,n._)("span",{class:"line-number"},"19"),(0,n._)("br"),(0,n._)("span",{class:"line-number"},"20"),(0,n._)("br"),(0,n._)("span",{class:"line-number"},"21"),(0,n._)("br"),(0,n._)("span",{class:"line-number"},"22"),(0,n._)("br"),(0,n._)("span",{class:"line-number"},"23"),(0,n._)("br"),(0,n._)("span",{class:"line-number"},"24"),(0,n._)("br"),(0,n._)("span",{class:"line-number"},"25"),(0,n._)("br")])],-1),I=(0,n._)("p",null,"此示例配置中首先配置如何连接跳板机，然后是通过跳板机代理连接gpu023和gpu010，再配置连接gpu024时从gpu023再次代理（即连接gpu024时共有两层代理）。同理，连接gpu011时通过gpu010代理。",-1),L=(0,n._)("p",null,"配置完成后即可通过简单的ssh命令访问服务器了：",-1),R=(0,n._)("div",{class:"language-bash ext-sh line-numbers-mode"},[(0,n._)("pre",{class:"language-bash"},[(0,n._)("code",null,[(0,n._)("span",{class:"token function"},"ssh"),(0,n.Uk)(" gpu024\n")])]),(0,n._)("div",{class:"line-numbers"},[(0,n._)("span",{class:"line-number"},"1"),(0,n._)("br")])],-1),V=(0,n._)("p",null,"也可在VS Code的远程SSH Targets中看到配置的服务器。",-1),Z=(0,n._)("h2",{id:"建立第一条隧道-通过云服务器访问校内服务器gpu023",tabindex:"-1"},[(0,n._)("a",{class:"header-anchor",href:"#建立第一条隧道-通过云服务器访问校内服务器gpu023","aria-hidden":"true"},"#"),(0,n.Uk)(" 建立第一条隧道，通过云服务器访问校内服务器gpu023")],-1),Y=(0,n._)("p",null,[(0,n._)("img",{src:p,alt:"img"})],-1),A=(0,n._)("p",null,"建立 红色的 tunnel 1，也叫做 SSH port forwarding。可以理解为在阿里云server上建立的一个穿透通路。这个通路一头是 阿里云服务器的port 2023，另一头是阿里云服务器的port 2222。",-1),B=(0,n._)("p",null,"这个tunnel建立之后，表示云服务器自己（localhost）从port 2023收听到的message会被全部转发到localhost的2222。",-1),E=(0,n._)("p",null,"为了安全考虑，在校内的gpu023服务器和阿里云服务器之间建立了单向的通道，即阿里云服务器不能访问校内服务器；但是校内服务器gpu023的 port 22在监听着阿里云服务器的port 2222发来的信息。",-1),F=(0,n._)("p",null,"因此，只要是云服务器的port 2023收到的信息，都可以认为是校内gpu023:22收到的。可以把阿里云服务器的localhost:2023就看成gpu023:22。",-1),K=(0,n._)("p",null,"只要建立了tunnel 1，则表示可以直接访问gpu023.",-1),M=(0,n._)("ol",null,[(0,n._)("li",null,[(0,n._)("p",null,[(0,n._)("strong",null,"配置阿里云服务器 Xshell")]),(0,n._)("p",null,[(0,n.Uk)("设置登录的服务器是"),(0,n._)("strong",null,"阿里云服务器"),(0,n.Uk)("。在xshell上保存密码或者把本机密钥放在云服务上。")]),(0,n._)("p",null,[(0,n._)("img",{src:r,alt:"阿里云服务器配置1"})]),(0,n._)("p",null,[(0,n._)("img",{src:t,alt:"阿里云服务器配置2"})]),(0,n._)("p",null,"在xshell上建立隧道，设置端口转发"),(0,n._)("p",null,[(0,n._)("img",{src:i,alt:"端口转发设置"})]),(0,n._)("p",null,"点开这个建立好的session，则表示用本地电脑登录了阿里云服务器，并且这条建立好的tunnel准备好要转发2023端口的message到2222端口了。"),(0,n._)("p",null,"所以之后本地电脑发送到localhost:2023的消息都会直接被转发到localhost:2222，最终到达gpu023:22。")]),(0,n._)("li",null,[(0,n._)("p",null,[(0,n._)("strong",null,"配置gpu023/gpu010的Xshell")]),(0,n._)("p",null,"新建一个session"),(0,n._)("p",null,[(0,n._)("img",{src:_,alt:"gpu023配置1"})]),(0,n._)("p",null,[(0,n._)("img",{src:c,alt:"gpu023配置2"})]),(0,n._)("p",null,"点击这个session可以登录到gpu023/gpu010")])],-1),Q=(0,n._)("h2",{id:"建立隧道访问其他服务器",tabindex:"-1"},[(0,n._)("a",{class:"header-anchor",href:"#建立隧道访问其他服务器","aria-hidden":"true"},"#"),(0,n.Uk)(" 建立隧道访问其他服务器")],-1),$=(0,n._)("p",null,[(0,n._)("img",{src:g,alt:""})],-1),ll=(0,n._)("p",null,"由于只有023，010暴露端口给外网了，所以剩下的其他服务器无法直接访问。因此，还需要把023作为第二层跳板机，来访问其他服务器。",-1),el=(0,n._)("ol",null,[(0,n._)("li",null,[(0,n._)("p",null,[(0,n._)("strong",null,"配置gpu023的Xshell")]),(0,n._)("p",null,[(0,n.Uk)("在"),(0,n._)("strong",null,"gpu023的xshell session"),(0,n.Uk)("中建立一条新的隧道")]),(0,n._)("p",null,"假设访问的是021"),(0,n._)("p",null,[(0,n._)("img",{src:o,alt:""})]),(0,n._)("p",null,"所有localhost port 2321 收到的message都会转发给 gpu021:22.")]),(0,n._)("li",null,[(0,n._)("p",null,[(0,n._)("strong",null,"配置其他服务器的xshell")]),(0,n._)("p",null,[(0,n._)("img",{src:m,alt:""})]),(0,n._)("p",null,[(0,n._)("img",{src:d,alt:""})]),(0,n._)("p",null,"之后在同时打开 aliyun server, gpu023两个session的情况下就能登录其他服务器"),(0,n._)("p",null,[(0,n._)("img",{src:b,alt:""})])])],-1),sl=(0,n._)("h2",{id:"配置gpu-pannel",tabindex:"-1"},[(0,n._)("a",{class:"header-anchor",href:"#配置gpu-pannel","aria-hidden":"true"},"#"),(0,n.Uk)(" 配置GPU pannel")],-1),nl=(0,n._)("p",null,"在gpu023建立隧道",-1),al=(0,n._)("p",null,[(0,n._)("img",{src:h,alt:"Grafana端口转发"})],-1),ul=(0,n._)("p",null,"在浏览器的地址栏访问 http://localhost:3000/dashboards",-1),pl=(0,n._)("p",null,[(0,n._)("img",{src:x,alt:"image-20210907123714063"})],-1),rl=(0,n._)("p",null,[(0,n._)("img",{src:f,alt:"Grafana选择GPU"})],-1),tl=(0,n._)("h2",{id:"下一步",tabindex:"-1"},[(0,n._)("a",{class:"header-anchor",href:"#下一步","aria-hidden":"true"},"#"),(0,n.Uk)(" 下一步")],-1),il=(0,n.Uk)("如何"),_l=(0,n.Uk)("在校外访问Web服务"),cl=(0,n.Uk)("，如Grafana、NextCloud等。"),gl={},ol=(0,s(3744).Z)(gl,[["render",function(l,e){const s=(0,n.up)("SelectTabItem"),a=(0,n.up)("SelectTab"),u=(0,n.up)("SelectContent"),p=(0,n.up)("RouterLink");return(0,n.wg)(),(0,n.iD)(n.HY,null,[k,U,v,H,S,w,P,y,C,G,J,(0,n.Wm)(a,{subject:"ssh_client"},{default:(0,n.w5)((()=>[(0,n.Wm)(s,{v:"ssh",default:""},{default:(0,n.w5)((()=>[W])),_:1}),(0,n.Wm)(s,{v:"xshell"},{default:(0,n.w5)((()=>[j])),_:1})])),_:1}),(0,n.Wm)(u,{s:"ssh_client",v:"ssh"},{default:(0,n.w5)((()=>[q,T,X,N,O,z,D,I,L,R,V])),_:1}),(0,n.Wm)(u,{s:"ssh_client",v:"xshell"},{default:(0,n.w5)((()=>[Z,Y,A,B,E,F,K,M,Q,$,ll,el,sl,nl,al,ul,pl,rl])),_:1}),tl,(0,n._)("p",null,[il,(0,n.Wm)(p,{to:"/guide/remote-web-access.html"},{default:(0,n.w5)((()=>[_l])),_:1}),cl])],64)}]])},2900:(l,e,s)=>{s.r(e),s.d(e,{data:()=>n});const n={key:"v-4492fbe6",path:"/guide/remote-server-access.html",title:"服务器校外访问",lang:"zh-CN",frontmatter:{},excerpt:"",headers:[{level:2,title:"前置条件",slug:"前置条件",children:[]},{level:2,title:"场景描述",slug:"场景描述",children:[]},{level:2,title:"用命令行访问",slug:"用命令行访问",children:[]},{level:2,title:"配置文件",slug:"配置文件",children:[]},{level:2,title:"建立第一条隧道，通过云服务器访问校内服务器gpu023",slug:"建立第一条隧道-通过云服务器访问校内服务器gpu023",children:[]},{level:2,title:"建立隧道访问其他服务器",slug:"建立隧道访问其他服务器",children:[]},{level:2,title:"配置GPU pannel",slug:"配置gpu-pannel",children:[]},{level:2,title:"下一步",slug:"下一步",children:[]}],filePathRelative:"guide/remote-server-access.md",git:{updatedTime:1662996813e3,contributors:[{name:"胡玮文",email:"huww98@outlook.com",commits:3},{name:"ZihaoLian",email:"2043740417@qq.com",commits:1},{name:"iris",email:"702451077@qq.com",commits:1}]}}},691:(l,e,s)=>{l.exports=s.p+"assets/img/grafana-GPU.df1fb452.png"},2667:(l,e,s)=>{l.exports=s.p+"assets/img/image-20210907123714063-1634721771705.124507a7.png"},2394:(l,e,s)=>{l.exports=s.p+"assets/img/image-20210907123821971.45c2952c.png"},5957:(l,e,s)=>{l.exports=s.p+"assets/img/image-20210908100811416.83f5b5b5.png"},1097:(l,e,s)=>{l.exports=s.p+"assets/img/image-20210908101024096.aa36a927.png"},4126:(l,e,s)=>{l.exports=s.p+"assets/img/image-20210908101213429.e28b8fcd.png"},4054:(l,e,s)=>{l.exports=s.p+"assets/img/image-20210908101242055.3fa61ab3.png"},9183:(l,e,s)=>{l.exports=s.p+"assets/img/image-20210908101620552.fb5f8cdf.png"},7604:(l,e,s)=>{l.exports=s.p+"assets/img/image-20210908101721945.f08d156a.png"},2986:(l,e,s)=>{l.exports=s.p+"assets/img/image-20210908102235109.514c15fb.png"},7331:(l,e,s)=>{l.exports=s.p+"assets/img/image-20210908102257785.95670f3e.png"},526:(l,e,s)=>{l.exports=s.p+"assets/img/image-20210908102457674.e9228ef6.png"},3863:(l,e,s)=>{l.exports=s.p+"assets/img/image-20211009103738645.f7ae4d78.png"},6306:(l,e,s)=>{l.exports=s.p+"assets/img/v2-6214f40be1d47c2270c7158378ab441c_b.c4a50577.png"},6507:(l,e,s)=>{l.exports=s.p+"assets/img/v2-c2b886cd93c387fc083e7ce44211c18d_b.83dac358.png"},6532:(l,e,s)=>{l.exports=s.p+"assets/img/v2-d12962cf3c9525a4a4e1e6d1e375feb9_b.057b487d.png"}}]);